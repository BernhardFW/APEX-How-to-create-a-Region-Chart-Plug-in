prompt --application/set_environment
set define off verify off feedback off
whenever sqlerror exit sql.sqlcode rollback
--------------------------------------------------------------------------------
--
-- ORACLE Application Express (APEX) export file
--
-- You should run the script connected to SQL*Plus as the Oracle user
-- APEX_200100 or as the owner (parsing schema) of the application.
--
-- NOTE: Calls to apex_application_install override the defaults below.
--
--------------------------------------------------------------------------------
begin
wwv_flow_api.import_begin (
 p_version_yyyy_mm_dd=>'2020.03.31'
,p_release=>'20.1.0.00.13'
,p_default_workspace_id=>21717127411908241868
,p_default_application_id=>138463
,p_default_id_offset=>0
,p_default_owner=>'RD_DEV'
);
end;
/
 
prompt APPLICATION 138463 - How to create a region plug-in
--
-- Application Export:
--   Application:     138463
--   Name:            How to create a region plug-in
--   Date and Time:   12:03 Friday May 1, 2020
--   Exported By:     RONNYWEISS@OUTLOOK.COM
--   Flashback:       0
--   Export Type:     Component Export
--   Manifest
--     PLUGIN: 11523523064035251667
--   Manifest End
--   Version:         20.1.0.00.13
--   Instance ID:     63113759365424
--

begin
  -- replace components
  wwv_flow_api.g_mode := 'REPLACE';
end;
/
prompt --application/shared_components/plugins/region_type/apex_hello_world_chart_amateur
begin
wwv_flow_api.create_plugin(
 p_id=>wwv_flow_api.id(11523523064035251667)
,p_plugin_type=>'REGION TYPE'
,p_name=>'APEX.HELLO.WORLD.CHART.AMATEUR'
,p_display_name=>'2. APEX Hello World Plug-in - apexchart.js - AMATEUR'
,p_supported_ui_types=>'DESKTOP'
,p_plsql_code=>wwv_flow_string.join(wwv_flow_t_varchar2(
'/* We just copy the code from APEX Page into the Plug-in and see that this is working */',
'FUNCTION F_RENDER (',
'    P_REGION                IN   APEX_PLUGIN.T_REGION,',
'    P_PLUGIN                IN   APEX_PLUGIN.T_PLUGIN,',
'    P_IS_PRINTER_FRIENDLY   IN   BOOLEAN',
') RETURN APEX_PLUGIN.T_REGION_RENDER_RESULT AS',
'/* the height can not be adjusted in this plugin */',
'C_CHART_HEIGHT CONSTANT VARCHAR2(100):= ''400px'';',
'/* in this plugin the chart type can not be set */',
'C_CHART_TYPE   CONSTANT VARCHAR2(100) := ''bar'';',
'/* the id of the region is static so plug-in can only be used one time please use P_REGION.STATIC_ID */',
'C_CHART_ID     CONSTANT VARCHAR2(100) := ''chart'';',
'VR_CUR         SYS_REFCURSOR;',
'VR_JSON_CLOB   CLOB;',
'VR_RENDER_RESULT APEX_PLUGIN.T_REGION_RENDER_RESULT;',
'BEGIN',
'    /* libary is not loaded from plug-in, it''s loaded as static file from app and will be missing in other apps */',
'    HTP.P(''<script src="'' ||:APP_IMAGES || ''apexcharts.js"></script>'');',
'',
'    /* draw region where chart should be added*/',
'    HTP.P(''<div id="''|| C_CHART_ID ||''"></div>'');',
'',
'    /* create data json for chart from cursor */',
'    APEX_JSON.INITIALIZE_CLOB_OUTPUT;',
'',
'    OPEN VR_CUR FOR P_REGION.ATTRIBUTE_01;',
'',
'    APEX_JSON.WRITE(VR_CUR);',
'',
'    /* store created json on var */',
'    VR_JSON_CLOB := APEX_JSON.GET_CLOB_OUTPUT(P_FREE => TRUE);',
'',
'    /* add own javascript to render chart */',
'    HTP.P(''<script>'');',
'    HTP.P(''',
'    var options = {',
'        chart: {',
'            type: "''|| C_CHART_TYPE ||''",',
'            height: "''|| C_CHART_HEIGHT ||''"',
'        },',
'        series: [{',
'            name: "Data",',
'            data: '' || VR_JSON_CLOB ||''',
'        }]',
'    };',
'    var chart = new ApexCharts(document.querySelector("#''|| C_CHART_ID ||''"), options);',
'    chart.render();',
'          '');',
'    HTP.P(''</script>'');',
'',
'    HTP.P (''<b>Used Data JSON:</b> '' || VR_JSON_CLOB);',
'    ',
'    RETURN VR_RENDER_RESULT;',
'',
'/* don''t forget the exception handling */',
'EXCEPTION',
'WHEN OTHERS THEN',
'    IF VR_CUR%ISOPEN THEN',
'        CLOSE VR_CUR;',
'    END IF;',
'    RAISE;',
'END;'))
,p_api_version=>2
,p_render_function=>'F_RENDER'
,p_substitute_attributes=>true
,p_subscribe_plugin_settings=>true
,p_version_identifier=>'1.0'
,p_about_url=>'https://github.com/RonnyWeiss/APEX-Hello-World-Plug-in'
,p_files_version=>6
);
wwv_flow_api.create_plugin_attribute(
 p_id=>wwv_flow_api.id(11673615664003263327)
,p_plugin_id=>wwv_flow_api.id(11523523064035251667)
,p_attribute_scope=>'COMPONENT'
,p_attribute_sequence=>1
,p_display_sequence=>10
,p_prompt=>'SQL Query'
,p_attribute_type=>'SQL'
,p_is_required=>true
,p_default_value=>'/* Default SQL Source function of APEX is not used and no default statement or help has been set here */'
,p_sql_min_column_count=>2
,p_sql_max_column_count=>2
,p_is_translatable=>false
);
end;
/
begin
wwv_flow_api.g_varchar2_table := wwv_flow_api.empty_varchar2_table;
wwv_flow_api.g_varchar2_table(1) := '4D4954204C6963656E73650A0A436F7079726967687420286329203230323020526F6E6E792057656973730A0A5065726D697373696F6E20697320686572656279206772616E7465642C2066726565206F66206368617267652C20746F20616E79207065';
wwv_flow_api.g_varchar2_table(2) := '72736F6E206F627461696E696E67206120636F70790A6F66207468697320736F66747761726520616E64206173736F63696174656420646F63756D656E746174696F6E2066696C657320287468652022536F66747761726522292C20746F206465616C0A';
wwv_flow_api.g_varchar2_table(3) := '696E2074686520536F66747761726520776974686F7574207265737472696374696F6E2C20696E636C7564696E6720776974686F7574206C696D69746174696F6E20746865207269676874730A746F207573652C20636F70792C206D6F646966792C206D';
wwv_flow_api.g_varchar2_table(4) := '657267652C207075626C6973682C20646973747269627574652C207375626C6963656E73652C20616E642F6F722073656C6C0A636F70696573206F662074686520536F6674776172652C20616E6420746F207065726D697420706572736F6E7320746F20';
wwv_flow_api.g_varchar2_table(5) := '77686F6D2074686520536F6674776172652069730A6675726E697368656420746F20646F20736F2C207375626A65637420746F2074686520666F6C6C6F77696E6720636F6E646974696F6E733A0A0A5468652061626F766520636F70797269676874206E';
wwv_flow_api.g_varchar2_table(6) := '6F7469636520616E642074686973207065726D697373696F6E206E6F74696365207368616C6C20626520696E636C7564656420696E20616C6C0A636F70696573206F72207375627374616E7469616C20706F7274696F6E73206F662074686520536F6674';
wwv_flow_api.g_varchar2_table(7) := '776172652E0A0A54484520534F4654574152452049532050524F564944454420224153204953222C20574954484F55542057415252414E5459204F4620414E59204B494E442C2045585052455353204F520A494D504C4945442C20494E434C5544494E47';
wwv_flow_api.g_varchar2_table(8) := '20425554204E4F54204C494D4954454420544F205448452057415252414E54494553204F46204D45524348414E544142494C4954592C0A4649544E45535320464F52204120504152544943554C415220505552504F534520414E44204E4F4E494E465249';
wwv_flow_api.g_varchar2_table(9) := '4E47454D454E542E20494E204E4F204556454E54205348414C4C205448450A415554484F5253204F5220434F5059524947485420484F4C44455253204245204C4941424C4520464F5220414E5920434C41494D2C2044414D41474553204F52204F544845';
wwv_flow_api.g_varchar2_table(10) := '520A4C494142494C4954592C205748455448455220494E20414E20414354494F4E204F4620434F4E54524143542C20544F5254204F52204F54484552574953452C2041524953494E472046524F4D2C0A4F5554204F46204F5220494E20434F4E4E454354';
wwv_flow_api.g_varchar2_table(11) := '494F4E20574954482054484520534F465457415245204F522054484520555345204F52204F54484552204445414C494E475320494E205448450A534F4654574152452E0A';
null;
end;
/
begin
wwv_flow_api.create_plugin_file(
 p_id=>wwv_flow_api.id(11523524485991251688)
,p_plugin_id=>wwv_flow_api.id(11523523064035251667)
,p_file_name=>'LICENSE'
,p_mime_type=>'application/octet-stream'
,p_file_charset=>'utf-8'
,p_file_content=>wwv_flow_api.varchar2_to_blob(wwv_flow_api.g_varchar2_table)
);
end;
/
begin
wwv_flow_api.g_varchar2_table := wwv_flow_api.empty_varchar2_table;
wwv_flow_api.g_varchar2_table(1) := '4C6963656E7365206170657863686172742E6A73202D2068747470733A2F2F6769746875622E636F6D2F617065786368617274732F617065786368617274732E6A730D0A0D0A546865204D4954204C6963656E736520284D4954290D0A0D0A436F707972';
wwv_flow_api.g_varchar2_table(2) := '6967687420286329203230313820417065784368617274730D0A0D0A5065726D697373696F6E20697320686572656279206772616E7465642C2066726565206F66206368617267652C20746F20616E7920706572736F6E206F627461696E696E67206120';
wwv_flow_api.g_varchar2_table(3) := '636F70790D0A6F66207468697320736F66747761726520616E64206173736F63696174656420646F63756D656E746174696F6E2066696C657320287468652022536F66747761726522292C20746F206465616C0D0A696E2074686520536F667477617265';
wwv_flow_api.g_varchar2_table(4) := '20776974686F7574207265737472696374696F6E2C20696E636C7564696E6720776974686F7574206C696D69746174696F6E20746865207269676874730D0A746F207573652C20636F70792C206D6F646966792C206D657267652C207075626C6973682C';
wwv_flow_api.g_varchar2_table(5) := '20646973747269627574652C207375626C6963656E73652C20616E642F6F722073656C6C0D0A636F70696573206F662074686520536F6674776172652C20616E6420746F207065726D697420706572736F6E7320746F2077686F6D2074686520536F6674';
wwv_flow_api.g_varchar2_table(6) := '776172652069730D0A6675726E697368656420746F20646F20736F2C207375626A65637420746F2074686520666F6C6C6F77696E6720636F6E646974696F6E733A0D0A0D0A5468652061626F766520636F70797269676874206E6F7469636520616E6420';
wwv_flow_api.g_varchar2_table(7) := '74686973207065726D697373696F6E206E6F74696365207368616C6C20626520696E636C7564656420696E0D0A616C6C20636F70696573206F72207375627374616E7469616C20706F7274696F6E73206F662074686520536F6674776172652E0D0A0D0A';
wwv_flow_api.g_varchar2_table(8) := '54484520534F4654574152452049532050524F564944454420224153204953222C20574954484F55542057415252414E5459204F4620414E59204B494E442C2045585052455353204F520D0A494D504C4945442C20494E434C5544494E4720425554204E';
wwv_flow_api.g_varchar2_table(9) := '4F54204C494D4954454420544F205448452057415252414E54494553204F46204D45524348414E544142494C4954592C0D0A4649544E45535320464F52204120504152544943554C415220505552504F534520414E44204E4F4E494E4652494E47454D45';
wwv_flow_api.g_varchar2_table(10) := '4E542E20494E204E4F204556454E54205348414C4C205448450D0A415554484F5253204F5220434F5059524947485420484F4C44455253204245204C4941424C4520464F5220414E5920434C41494D2C2044414D41474553204F52204F544845520D0A4C';
wwv_flow_api.g_varchar2_table(11) := '494142494C4954592C205748455448455220494E20414E20414354494F4E204F4620434F4E54524143542C20544F5254204F52204F54484552574953452C2041524953494E472046524F4D2C0D0A4F5554204F46204F5220494E20434F4E4E454354494F';
wwv_flow_api.g_varchar2_table(12) := '4E20574954482054484520534F465457415245204F522054484520555345204F52204F54484552204445414C494E475320494E0D0A54484520534F4654574152452E';
null;
end;
/
begin
wwv_flow_api.create_plugin_file(
 p_id=>wwv_flow_api.id(11671557014821729128)
,p_plugin_id=>wwv_flow_api.id(11523523064035251667)
,p_file_name=>'LICENSE4LIBS'
,p_mime_type=>'application/octet-stream'
,p_file_charset=>'utf-8'
,p_file_content=>wwv_flow_api.varchar2_to_blob(wwv_flow_api.g_varchar2_table)
);
end;
/
prompt --application/end_environment
begin
wwv_flow_api.import_end(p_auto_install_sup_obj => nvl(wwv_flow_application_install.get_auto_install_sup_obj, false));
commit;
end;
/
set verify on feedback on define on
prompt  ...done
